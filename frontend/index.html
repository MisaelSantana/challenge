<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge - Calculate</title>
    <link rel="stylesheet" href="./assets/css/reset.css">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;1,100&display=swap" rel="stylesheet">
</head>
<body>
    <header class="nav-bar">
        Desafio - Calculadora de consumo de combustível
    </header>

    <!-- Body card -->
    <div class="container">

        <div class="card">
            <section class="history">
                <h1>Histórico de cálculos feitos</h1>
                <ul id="dados"></ul>
            </section>

            <section class="section-inputs">
                <h1>Novo Cálculo</h1>
                <!-- Form with inputs -->
                <form action="post" class="section-inputs-input">

                        <input type="number"
                        id="partida"
                        name="partida"
                        placeholder="Insira a localização inicial">
        
                        <input type="number"
                        id="destino"
                        name="destino"
                        placeholder="Insira o seu destino">

                        <input type="number"
                        id="km40"
                        name="km40"
                        placeholder="KM percorridos á 40 KM/h">
                    
                        <input type="number"
                        id="km60"
                        name="km60"
                        placeholder="KM percorridos á 60 KM/h">
                    
                        <input type="number"
                        id="km80"
                        name="km80"
                        placeholder="KM percorridos á 80 KM/h">
                    
                        <input type="number"
                        id="km100"
                        name="km100"
                        placeholder="KM percorridos á 100 KM/h">
                </form>

                <button class="add-button"
                    type="button"
                    onclick="createData()">
                    Adicionar</button>
            </section>
        </div>
    </div>

<!-- Import Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- Functions JavaScripts -->
<script>
    // get function onLoad for to bring all functions
    onLoad();

    async function onLoad() {
        const url = 'http://localhost:9000/api/dados'
        try {
            const response = await axios.get(url);
            getAllData(response);
        }
        catch(error) {
            console.log(error);
        }
    }

    // Function that brings all the data;
    function getAllData(response) {
        const dados = response.data;
        const list = document.getElementById('dados');
        dados.forEach(dado => {
            const item = document.createElement('li');
            item.setAttribute('data-id', dado.id);
            item.innerHTML = `${dado.id} - ${dado.partida} - ${dado.destino} - ${dado.km40} - ${dado.km60} - ${dado.km80} - ${dado.km100}`;
            list.appendChild(item);
        });
    }

    // Function that create new data;
    function createData() {
        const partidaField = document.querySelector('#partida').value;
        const destinoField = document.querySelector('#destino').value;
        const km40Field = document.querySelector('#km40').value;
        const km60Field = document.querySelector('#km60').value;
        const km80Field = document.querySelector('#km80').value;
        const km100Field = document.querySelector('#km100').value;

        const url = 'http://localhost:9000/api/dado';
        const data = {
            partida: partidaField,
            destino: destinoField,
            km40: km40Field,
            km60: km60Field,
            km80: km80Field,
            km100: km100Field
        }
        
        axios.post(url, data)
        .then((response) => {
            if(response.status === 200) {
                alert('Inserido com sucesso!');
            }
        }).catch((error) => {
            console.log(error);
        });
    }
</script>
</body>
</html>